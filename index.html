<!DOCTYPE html>
<html>
<head>
  <!-- Include meta charset, or bad things will happen! -->
  <meta charset="utf-8" />
  <title>Bike Shop Search</title>
  <link rel="stylesheet" href="styles/main.css" type="text/css"/>
</head>

<body>
  <input type="search" id="searchTerm" placeholder="Type here">
  
  <ul id="list"></ul>


  <script type="text/javascript">
    // search URLs must have this form: http://www.*************
    var srcUrls = [
      'http://www.bike-components.de/advanced_search_result.php/language/en/?limit=48&keywords=',
      'http://www.rosebikes.com/search/find/?order=price|asc&count=64&q=',
      'http://www.rczbikeshop.com/default/catalogsearch/result/?dir=asc&order=price&q=',
      'http://www.amazon.co.uk/s/field-keywords=',
      'http://www.amazon.de/s/field-keywords=',
      'http://www.wiggle.co.uk/?s=',
      'http://www.bike-discount.de/en/praesenz/search/?o=preis&q=',
      'http://www.chainreactioncycles.com/ro/en/s?sort=pricelow&q=',
      'http://www.planetx.co.uk/search-results?keywords=',
      'http://www.bike24.com/1.php?content=13&navigation=1&search=',
      'http://www.evanscycles.com/search?sort_by=asc&query=',
    ];

    // <li>
    //   <a href="http://www.bike-components.de/en/" target="www.bike-components.de">bike-components.de</a>
    //   <a><img src="images/toolbar_find.png"></a>
    // </li>
    function createList(srcUrls) {
      var fragment = document.createDocumentFragment();

      srcUrls.forEach( function (url, index) {
        var homepage = getHomepage(url);
        var htmlListItem = document.createElement('li');
        var htmlHomepage = document.createElement('a');
        var htmlSearchLink = document.createElement('a');
        var htmlImg = document.createElement('img');

        htmlHomepage.appendChild( document.createTextNode( homepage.slice(4)) ); // 'www.homepage.com'.slice(4) == 'homepage.com'
        htmlHomepage.href = 'http://' + homepage;
        htmlHomepage.target = homepage;
        htmlListItem.appendChild( htmlHomepage );

        htmlImg.src = "images/toolbar_find.png";
        htmlSearchLink.appendChild( htmlImg );
        htmlSearchLink.onclick = function () {
          // window.opnen sintax:
          // var windowObjectReference = window.open(strUrl, strWindowName[, strWindowFeatures]);
          window.open( url + getSearchTerm(), homepage);
          // prevents default behaviour of links
          // return false;
        };
        htmlListItem.appendChild( htmlSearchLink );

        fragment.appendChild( htmlListItem );
      });

      document.getElementById('list').appendChild(fragment);
    }
    

    function getSearchTerm() {
      return encodeURI(document.getElementById('searchTerm').value);
    }

    function getHomepage(searchUrl) {
      // 'http://www.wiggle.co.uk/?s='.split('/') == ["http:", "", "www.wiggle.co.uk", "?s="]
      var urlParts = searchUrl.split('/');
      return urlParts[2];
    }

    createList(srcUrls);
  </script>
</body>
</html>